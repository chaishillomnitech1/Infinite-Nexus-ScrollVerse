name: ðŸ§¿ Welcome Divine Contributors

on:
  issues:
    types: [opened]
  pull_request_target:
    types: [opened]

permissions:
  issues: write
  pull-requests: write

jobs:
  welcome:
    name: Welcome New Contributors
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ§¿ Welcome with 528Hz Divine Resonance
        uses: actions/github-script@v8
        with:
          script: |
            const creator = context.payload.sender.login;
            const isIssue = !!context.payload.issue;
            const isPR = !!context.payload.pull_request;
            const number = isIssue ? context.payload.issue.number : context.payload.pull_request.number;
            
            // Check if this is the user's first contribution
            const { data: issues } = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              creator: creator,
              state: 'all',
              per_page: 2
            });
            
            const isFirstContribution = issues.length <= 1;
            
            let welcomeMessage = '';
            const divider = "---\n\n";
            const boxTop = "```\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n";
            const boxMid = "â•‘              âœ§ï½¥ï¾Ÿ: *âœ§ï½¥ï¾Ÿ:* DIVINE RESONANCE *:ï½¥ï¾Ÿâœ§*:ï½¥ï¾Ÿâœ§              â•‘\n";
            const boxBot = "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n";
            
            if (isIssue) {
              welcomeMessage = "# ðŸŒŒ Welcome to the Infinite-Nexus-ScrollVerse, @" + creator + "!\n\n";
              welcomeMessage += boxTop + boxMid;
              welcomeMessage += "â•‘        Your consciousness has aligned with the ScrollVerse       â•‘\n";
              welcomeMessage += "â•‘              at the miraculous frequency of 528Hz                â•‘\n";
              welcomeMessage += boxBot;
              
              if (isFirstContribution) {
                welcomeMessage += "## ðŸŽŠ First Contribution Detected!\n\n";
                welcomeMessage += "Welcome to your journey as a co-creator of the omniversal tapestry!\n\n";
              }
              
              welcomeMessage += "## âœ¨ Thank You for Your Issue\n\n";
              welcomeMessage += "Your contribution resonates with the core principles of **Infinite-Nexus-ScrollVerse**:\n\n";
              welcomeMessage += "- ðŸŒ€ **Hyperdimensional Scalability** - Transcending traditional dimensional limitations\n";
              welcomeMessage += "- ðŸ•‰ï¸ **Divine Inspiration-Driven Design** - Alignment with universal consciousness\n";
              welcomeMessage += "- ðŸŒ **Omniversal Alignment** - Weaving infinite threads across all dimensions\n\n";
              welcomeMessage += divider;
              welcomeMessage += "## ðŸŽ¯ Next Steps\n\n";
              welcomeMessage += "1. Review our [Contributing Guide](../CONTRIBUTING.md)\n";
              welcomeMessage += "2. Explore the [Architecture](../docs/ARCHITECTURE.md)\n";
              welcomeMessage += "3. Read the [Resonance Guide](../docs/RESONANCE_GUIDE.md)\n\n";
              welcomeMessage += divider;
              welcomeMessage += "_May your code transcend all dimensions_ âˆž\n\n";
              welcomeMessage += "**Frequency: 528Hz** | **Resonance: Divine** | **Alignment: Omniversal** ðŸ§¿";
              
            } else if (isPR) {
              welcomeMessage = "# ðŸŒŸ Sacred Pull Request Received, @" + creator + "!\n\n";
              welcomeMessage += boxTop;
              welcomeMessage += "â•‘              âœ§ï½¥ï¾Ÿ: *âœ§ï½¥ï¾Ÿ:* PULL REQUEST PORTAL *:ï½¥ï¾Ÿâœ§*:ï½¥ï¾Ÿâœ§            â•‘\n";
              welcomeMessage += "â•‘     Your divine code contribution has entered the ScrollVerse    â•‘\n";
              welcomeMessage += "â•‘            Resonating at the miracle frequency of 528Hz          â•‘\n";
              welcomeMessage += boxBot;
              
              if (isFirstContribution) {
                welcomeMessage += "## ðŸŽŠ First Pull Request - A Sacred Milestone!\n\n";
                welcomeMessage += "You have taken the first step in co-creating the omniversal tapestry!\n\n";
              }
              
              welcomeMessage += "## âœ¨ Thank You for Your Contribution\n\n";
              welcomeMessage += "Your pull request embodies the essence of collaborative divine creation.\n\n";
              welcomeMessage += divider;
              welcomeMessage += "## ðŸ” What Happens Next\n\n";
              welcomeMessage += "1. **ðŸ¤– Automated Validation** - CI/CD checks for code quality\n";
              welcomeMessage += "2. **ðŸ›¡ï¸ Manifesto Guardian Protocol** - Validates sacred seals\n";
              welcomeMessage += "3. **ðŸ‘ï¸ Human Review** - Maintainers assess implications\n";
              welcomeMessage += "4. **âš¡ Integration** - Upon approval, merges into codebase\n\n";
              welcomeMessage += divider;
              welcomeMessage += "## âœ… Pre-Merge Checklist\n\n";
              welcomeMessage += "- [ ] **528Hz Frequency Standards** - Timing uses 528Hz-derived values\n";
              welcomeMessage += "- [ ] **Sacred Geometry** - Golden ratio (Ï† = 1.618) and Fibonacci\n";
              welcomeMessage += "- [ ] **Arcturian Colors** - #528BFF, #FFD700, #00FFAA\n";
              welcomeMessage += "- [ ] **Web3 Integration** - Follows Web3.js patterns if applicable\n";
              welcomeMessage += "- [ ] **Documentation** - Code changes include relevant docs\n\n";
              welcomeMessage += divider;
              welcomeMessage += "_May your code manifest miracles across infinite dimensions_ ðŸ§¿\n\n";
              welcomeMessage += "**Frequency: 528Hz** | **Resonance: Divine** | **Alignment: Omniversal**\n\n";
              welcomeMessage += "**Namaste** ðŸ™";
            }
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: number,
              body: welcomeMessage
            });

      - name: ðŸ·ï¸ Add welcome label
        uses: actions/github-script@v8
        with:
          script: |
            const issueNumber = context.payload.issue?.number || context.payload.pull_request?.number;
            
            if (issueNumber) {
              try {
                await github.rest.issues.addLabels({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: issueNumber,
                  labels: ['divine-resonance', 'needs-review']
                });
              } catch (error) {
                console.log('Labels may not exist yet, skipping');
              }
            }

      - name: ðŸ“Š Log contribution metrics
        run: |
          echo "# ðŸ§¿ New Contribution Logged" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Contributor**: @${{ github.event.sender.login }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Type**: ${{ github.event_name }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Frequency**: 528Hz" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ¨ _Divine contribution recorded_ ðŸ§¿" >> $GITHUB_STEP_SUMMARY
